<html>

    <?php

        $resource = htmlspecialchars($_SERVER["PHP_SELF"]);

        if (isset($_POST["username"]) && isset($_POST["password"])) {

            // Create connection
            $conn = new mysqli("localhost", "root", "", "lubjanka");

            // Check connection
            if ($conn->connect_error) 

                die("Connection failed: " . $conn->connect_error);

            else {

            $toPrint = "<head>
                    <title>Profile</title>
                </head>
                <body style = \"justify-content: center\">
                    <h2>Available infos</h2>";

            $sql = "SELECT o.firstname, o.lastname, s.title FROM oligarchs o 
                    JOIN involvements i ON i.oligarch_username = o.username AND i.oligarch_password = o.password 
                    JOIN stuffs s ON s.title = i.stuff_id 
                    WHERE o.username = \"" . $_POST["username"] . "\" AND o.password = \"" . $_POST["password"] . "\" AND s.legality = 1";

            $result = $conn->query($sql);

            if ($result->num_rows > 0) {

                $first = true;

                while ($row = $result->fetch_assoc()) 

                    if ($first) {

                        $toPrint .= "<h3>Firstname</h3>" . $row["firstname"] . "<h3>Lastname</h3>" . $row["lastname"] . "<h3>Activities</h3>" . $row["title"] . "<br>";

                        $first = false;

                    }
                    
                    else

                        $toPrint .= $row["title"] . "<br>";

            }
            
            else

                $toPrint .= "<p>0 results</p><br>";

            $toPrint .= "<br><a href=\"" . $resource . "\">Reauthenticate</a></body>";

            echo $toPrint;

            $conn->close();

        }

        }
        
        else 
            
            echo "<head>
                <title>Auth</title>
            </head>
            <body>
                <fieldset style=\"width: fit-content; display: flex; justify-content: center; align-items: center\">
                    <legend><h1>The Most Susceptible Russian Database</h1></legend>
                    <form action=\"" . $resource . "\" method=\"post\">
                        <label for=\"username\" style=\"display: block; text-align: center;\">Username</label>
                        <input type=\"text\" id=\"username\" name=\"username\" style=\"display: block; margin: auto;\"><br>
                        <label for=\"password\" style=\"display: block; text-align: center;\">Password</label>
                        <input type=\"text\" id=\"password\" name=\"password\" style=\"display: block; margin: auto;\"><br>
                        <input type=\"submit\" value=\"Login\" style=\"display: block; margin: auto;\">
                    </form>
                </fieldset>
            </body>";
        
    ?>

</html>