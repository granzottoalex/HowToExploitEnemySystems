-- Active: 1671574254493@@127.0.0.1@5432@postgres
CREATE DATABASE lubjanka;
SHOW DATABASES;
\l;
USE lubjanka;
\c lubjanka;
SHOW TABLES;
\d;
CREATE TABLE oligarchi (id INT PRIMARY KEY AUTO_INCREMENT, username VARCHAR(255), password VARCHAR(255), 
    firstname VARCHAR(255), lastname VARCHAR(255), terrorismo TINYINT(1), traffico_armi TINYINT(1), 
        tortura TINYINT(1));
DESCRIBE oligarchi;
\dS oligarchi;
INSERT INTO oligarchi VALUES (NULL,'Puffball','Diane','hamster','100kilos', 1, 0, 1);
SELECT * FROM oligarchi;
--TRUNCATE TABLE oligarchi;
--DROP TABLE oligarchi;
ALTER TABLE oligarchi DROP id, ADD PRIMARY KEY(username, password);
ALTER TABLE oligarchi ADD COLUMN riciclaggio_denaro TINYINT(1);
ALTER TABLE oligarchi MODIFY COLUMN riciclaggio_denaro TINYINT(1) NOT NULL;
INSERT INTO oligarchi VALUES('u', 'p', 'yaroslay', 'karashenko', 1, 0, 1, 0),
    ('us', 'pa', 'nikolay', 'karashova', 0, 1, 0, 1),
    ('un', 'pw', 'alexey', 'karamov', 1, 1, 1, 1),
    ('ue', 'pd', 'yury', 'karashnikov', 0, 0, 0, 0);
ALTER TABLE oligarchi ADD COLUMN corruzione_organi_statali TINYINT(1) NOT NULL;
UPDATE oligarchi SET corruzione_organi_statali = 1 WHERE username = 'u' OR username = 'un';
RENAME TABLE oligarchi TO oligarchs;
ALTER TABLE oligarchs DROP COLUMN tortura, 
    DROP COLUMN terrorismo, 
    DROP COLUMN traffico_armi, 
    DROP COLUMN riciclaggio_denaro, 
    DROP COLUMN corruzione_organi_statali;
CREATE TABLE stuffs (title VARCHAR(255) PRIMARY KEY, legality TINYINT(1));
CREATE TABLE involvements (stuff_id VARCHAR(255) NOT NULL, 
    FOREIGN KEY (stuff_id) REFERENCES stuffs(title) ON DELETE CASCADE ON UPDATE CASCADE, 
        oligarch_username VARCHAR(255) NOT NULL, 
            oligarch_password VARCHAR(255) NOT NULL, 
            FOREIGN KEY (oligarch_username, oligarch_password) REFERENCES oligarchs(username, password)
                ON DELETE CASCADE ON UPDATE CASCADE);
INSERT INTO stuffs VALUES
    ('riciclaggio_denaro', 0),
    ('evasione_fiscale', 0),
    ('frode', 0),
    ('corruzione', 0),
    ('estrazione_materie_prime', 1),
    ('politica', 1),
    ('finanza', 1),
    ('industria', 1);
ALTER TABLE involvements ADD PRIMARY KEY (stuff_id, oligarch_username, oligarch_password);
DELETE FROM stuffs WHERE title = 'riciclaggio_denaro' OR title = 'evasione_fiscale' OR title = 'estrazione_materie_prime';
INSERT INTO stuffs VALUES
    ('riciclaggio denaro', 0),
    ('evasione fiscale', 0),
    ('estrazione materie prime', 0);
INSERT INTO involvements VALUES
    ('industria', 'u', 'p'),
    ('evasione fiscale', 'u', 'p'),
    ('finanza', 'un', 'pw'),
    ('frode', 'un', 'pw'),
    ('politica', 'us', 'pa'),
    ('estrazione materie prime', 'us', 'pa'),
    ('riciclaggio denaro', 'ue', 'pd'),
    ('corruzione', 'ue', 'pd');
UPDATE stuffs SET legality = 1 WHERE title = 'estrazione materie prime';
SELECT o.firstname, o.lastname, s.title FROM oligarchs o 
    JOIN involvements i ON i.oligarch_username = o.username AND i.oligarch_password = o.password
    JOIN stuffs s ON s.title = i.stuff_id 
    WHERE o.username = 'us' AND o.password = 'pa' AND s.legality = 1;